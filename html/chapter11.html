<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>Chapter 11 â€” ç»¼åˆæ¡ˆä¾‹ï¼šå®ç°ä¸€ä¸ªå¯æ’æ‹”çš„ Coding Agent (chapter11.md)</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>ç›®å½•</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="æœç´¢..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">ã€Šç”¨ IO Monad æ­å»º LLM Agentï¼šä» Kleisli åˆ°äº‹ä»¶å»ºæ¨¡ä¸ FRPã€‹ç›®å½•ï¼ˆindex.mdï¼‰</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 1 â€” LLM Agent çš„â€œæŠ½è±¡è¾¹ç•Œâ€ï¼šä¸ºä»€ä¹ˆä» IO Monad å‡ºå‘</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 2 â€” IO Monad é€Ÿæˆï¼šä»æ¦‚å¿µåˆ°å·¥ç¨‹å®ç°</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 3 â€” Kleisli Arrowï¼šæŠŠâ€œå¸¦ IO çš„å‡½æ•°â€å½“ä½œå¯ç»„åˆç®­å¤´</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 4 â€” Agent DSLï¼šæŠŠå·¥å…·ã€è®°å¿†ä¸æ§åˆ¶æµåšæˆâ€œå¯è§£é‡Šçš„ effectâ€</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 5 â€” Runtime ä¸è°ƒåº¦ï¼šä»è§£é‡Šå™¨åˆ°å¹¶å‘ã€å–æ¶ˆä¸èµ„æºç®¡ç† (chapter5.md)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 6 â€” äº‹ä»¶å»ºæ¨¡ï¼šIO timeoutã€é‡è¯•ã€é€€é¿ã€ç†”æ–­ä¸é¢„ç®—</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 7 â€” Coding Agent çš„ Loop Detectionï¼šè®© Agent å¯ç»ˆæ­¢ã€å¯è§£é‡Š</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 8 â€” A/B Test ä¸è¯„ä¼°ï¼šæŠŠå®éªŒåµŒè¿› IO/Kleisli ç®¡é“</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 9 â€” å¯è§‚æµ‹æ€§ï¼šTrace/Spanã€æ—¥å¿—ã€æŒ‡æ ‡ä¸å¯å¤ç°</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 10 â€” ä¸ FRP çš„å…³ç³»ï¼šå½“ Agent å˜æˆâ€œäº‹ä»¶æµå¤„ç†å™¨â€ (chapter10.md)</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 11 â€” ç»¼åˆæ¡ˆä¾‹ï¼šå®ç°ä¸€ä¸ªå¯æ’æ‹”çš„ Coding Agent (chapter11.md)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 12 â€” æ‰©å±•é˜…è¯»ä¸è·¯çº¿å›¾ï¼šé€šå¾€ç±»å‹å®‰å…¨ä¸ç”Ÿäº§ç¯å¢ƒçš„å½¼å²¸</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter13.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 13 â€” é™„å½•ï¼šç»ˆæå‚è€ƒæ‰‹å†Œ (The Ultimate Reference)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter14.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 14 â€” Search API + RAGï¼šæ„å»ºæ£€ç´¢å¢å¼ºçš„ RAG Agent</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="chapter-11-coding-agent-chapter11md">Chapter 11 â€” ç»¼åˆæ¡ˆä¾‹ï¼šå®ç°ä¸€ä¸ªå¯æ’æ‹”çš„ Coding Agent (chapter11.md)</h1>
<h2 id="1">1. å¼€ç¯‡æ®µè½ï¼šä»ç§¯æœ¨åˆ°æ‘©å¤©å¤§æ¥¼</h2>
<p>åœ¨å‰é¢çš„åç« ä¸­ï¼Œæˆ‘ä»¬æ‹†è§£äº†æ„å»º LLM Agent çš„æ‰€æœ‰æ•°å­¦åŸºç¡€ä¸å·¥ç¨‹åŸè¯­ï¼šIO Monad è´Ÿè´£å‰¯ä½œç”¨ç®¡ç†ï¼ŒKleisli Arrows è´Ÿè´£é€»è¾‘ç»„åˆï¼ŒState Monad è´Ÿè´£è®°å¿†ç®¡ç†ï¼ŒFRP è´Ÿè´£æµå¼äº¤äº’ã€‚ç°åœ¨ï¼Œæ˜¯æ—¶å€™å°†å®ƒä»¬ç»„è£…åœ¨ä¸€èµ·äº†ã€‚</p>
<p>æœ¬ç« æˆ‘ä»¬å°†æ„å»º <strong><code>PolyGlotCoder</code></strong> â€”â€” ä¸€ä¸ªç”Ÿäº§çº§ã€æ¶æ„æ¸…æ™°çš„ Coding Agentã€‚ä¹‹æ‰€ä»¥ç§°ä¸ºâ€œå¯æ’æ‹”ï¼ˆPluggableï¼‰â€ï¼Œæ˜¯å› ä¸ºå®ƒéµå¾ª<strong>ä¾èµ–å€’ç½®åŸåˆ™</strong>ï¼ˆDependency Inversion Principleï¼‰çš„å‡½æ•°å¼ç‰ˆæœ¬ï¼š</p>
<ol>
<li><strong>èƒ½åŠ›ä¸å®ç°åˆ†ç¦»</strong>ï¼šAgent åªçŸ¥é“â€œæˆ‘è¦è¯»æ–‡ä»¶â€ï¼Œä¸çŸ¥é“æ˜¯è¯»æœ¬åœ°ç£ç›˜è¿˜æ˜¯ GitHub APIã€‚</li>
<li><strong>ç­–ç•¥ä¸æ‰§è¡Œåˆ†ç¦»</strong>ï¼šAgent çš„ Loop Detectionã€Retry ç­–ç•¥æ˜¯ä½œä¸ºâ€œä¸­é—´ä»¶â€æŒ‚è½½çš„ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç åœ¨ä¸šåŠ¡æµä¸­ã€‚</li>
<li><strong>IO ä¸ UI åˆ†ç¦»</strong>ï¼šAgent æ ¸å¿ƒåœ¨ IO Monad ä¸­åŒæ­¥è¿è¡Œï¼Œé€šè¿‡ FRP ç®¡é“ä¸å¼‚æ­¥çš„ UI ä¸–ç•Œé€šä¿¡ã€‚</li>
</ol>
<p><strong>å­¦ä¹ ç›®æ ‡</strong>ï¼š</p>
<ul>
<li><strong>æ¶æ„è®¾è®¡</strong>ï¼šæŒæ¡ Final Tagless / Free Monad é£æ ¼çš„ Agent åˆ†å±‚æ¶æ„ã€‚</li>
<li><strong>æµç¨‹ç¼–æ’</strong>ï¼šå®æˆ˜ä½¿ç”¨ Kleisli Arrow ä¸²è” Plan-Act-Observe å¾ªç¯ã€‚</li>
<li><strong>å®‰å…¨æ‹¦æˆª</strong>ï¼šå®ç°åŸºäºæŒ‡çº¹çš„ Loop Detection ä¸­é—´ä»¶ã€‚</li>
<li><strong>å®éªŒæ¡†æ¶</strong>ï¼šå¦‚ä½•åœ¨ä¸ä¿®æ”¹æ ¸å¿ƒä»£ç çš„å‰æä¸‹ï¼Œé€šè¿‡è§£é‡Šå™¨æ³¨å…¥ A/B Testã€‚</li>
</ul>
<hr />
<h2 id="2">2. æ ¸å¿ƒæ¶æ„ï¼šæ´‹è‘±æ¨¡å‹</h2>
<p>æˆ‘ä»¬å°†é‡‡ç”¨<strong>æ´‹è‘±æ¶æ„ï¼ˆOnion Architectureï¼‰</strong>ï¼Œç”±å†…å‘å¤–ä¾æ¬¡æ˜¯ï¼š</p>
<ol>
<li><strong>Domain Algebra (DSL)</strong>: å®šä¹‰ Agent èƒ½åšä»€ä¹ˆï¼ˆEffect æ¥å£ï¼‰ã€‚</li>
<li><strong>Business Logic (Program)</strong>: ä½¿ç”¨ DSL ç¼–å†™çš„çº¯é€»è¾‘ï¼ˆKleisli Arrowsï¼‰ã€‚</li>
<li><strong>Middleware (Interceptors)</strong>: æ—¥å¿—ã€ç†”æ–­ã€å¾ªç¯æ£€æµ‹ã€‚</li>
<li><strong>Interpreters (Runtime)</strong>: å°† DSL ç¿»è¯‘ä¸ºå®é™…æ“ä½œï¼ˆAPI è°ƒç”¨ã€Docker æ‰§è¡Œï¼‰ã€‚</li>
<li><strong>External Interface (FRP)</strong>: å¤„ç†ç”¨æˆ·è¾“å…¥æµå’Œ UI è¾“å‡ºæµã€‚</li>
</ol>
<div class="codehilite"><pre><span></span><code>       +-------------------------------------------------------+
       |                  FRP Interface (UI/Stream)            |
       +-------------------------------------------------------+
              | (Events)                         ^ (Tokens/Logs)
+-------------v----------------------------------|-------------+
|      Runtime / Interpreters (The &quot;Dirty&quot; World)              |
|  [Docker] [OpenAI API] [Vector DB] [Prometheus] [AB Platform]|
+--------------------------------------------------------------+
              | (Inject Implementation)
+-------------v------------------------------------------------+
|      Middleware Layer (Safety &amp; Observability)               |
|  [Loop Detector] [Budget Breaker] [Tracer] [Retry Policy]    |
+--------------------------------------------------------------+
              | (Wrap)
+-------------v------------------------------------------------+
|      Business Logic (Pure Kleisli Arrows)                    |
|  Plan -&gt; Code -&gt; Lint -&gt; Test -&gt; Fix -&gt; Submit               |
+--------------------------------------------------------------+
              | (Depends on)
+-------------v------------------------------------------------+
|      Domain Algebra (DSL Interface)                          |
|  type CodingApp = Chat &amp; FS &amp; Shell &amp; Git &amp; Clock            |
+--------------------------------------------------------------+
</code></pre></div>

<hr />
<h2 id="3-domain-algebra">3. ç¬¬ä¸€å±‚ï¼šå®šä¹‰èƒ½åŠ›ä»£æ•° (Domain Algebra)</h2>
<p>æˆ‘ä»¬ä¸ç›´æ¥å†™ä»£ç ï¼Œè€Œæ˜¯å®šä¹‰ä¸€ç»„ <strong>Effect æ¥å£</strong>ã€‚åœ¨ TypeScript ä¸­é€šå¸¸è¡¨ç°ä¸º Interfaceï¼Œåœ¨ Scala/Haskell ä¸­è¡¨ç°ä¸º Type Classã€‚</p>
<h3 id="31-effect">3.1 æ ¸å¿ƒ Effect å®šä¹‰</h3>
<p>æˆ‘ä»¬éœ€è¦ä»¥ä¸‹äº”ç»„æ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<ol>
<li><strong><code>LLM</code></strong>: è´Ÿè´£å¤§æ¨¡å‹äº¤äº’ã€‚</li>
<li><strong><code>WorkSpace</code></strong>: è´Ÿè´£æ–‡ä»¶ä¸ Shell æ“ä½œï¼ˆé€šå¸¸åœ¨æ²™ç®±ä¸­ï¼‰ã€‚</li>
<li><strong><code>Git</code></strong>: è´Ÿè´£ç‰ˆæœ¬æ§åˆ¶ã€‚</li>
<li><strong><code>Observability</code></strong>: è´Ÿè´£ Metrics å’Œ Tracingã€‚</li>
<li><strong><code>Experiment</code></strong>: è´Ÿè´£è·å– A/B æµ‹è¯•é…ç½®</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1">-- ä¼ªä»£ç å½¢å¼çš„ä»£æ•°å®šä¹‰</span>

<span class="c1">-- 1. LLM èƒ½åŠ›</span>
<span class="nf">interface</span><span class="w"> </span><span class="kt">LLM</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">chat</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">[</span><span class="kt">Message</span><span class="p">]</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">ModelConfig</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="kt">Stream</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span>
<span class="w">  </span><span class="n">embed</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="kt">Vector</span>

<span class="c1">-- 2. æ²™ç®±ç¯å¢ƒèƒ½åŠ›</span>
<span class="nf">interface</span><span class="w"> </span><span class="kt">WorkSpace</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">readFile</span><span class="w">  </span><span class="ow">::</span><span class="w"> </span><span class="kt">Path</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="kt">String</span>
<span class="w">  </span><span class="n">writeFile</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Path</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Content</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="nb">()</span>
<span class="w">  </span><span class="n">exec</span><span class="w">      </span><span class="ow">::</span><span class="w"> </span><span class="kt">Command</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Timeout</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">(</span><span class="kt">ExitCode</span><span class="p">,</span><span class="w"> </span><span class="kt">Stdout</span><span class="p">,</span><span class="w"> </span><span class="kt">Stderr</span><span class="p">)</span>
<span class="w">  </span><span class="n">ls</span><span class="w">        </span><span class="ow">::</span><span class="w"> </span><span class="kt">Path</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">[</span><span class="kt">Path</span><span class="p">]</span>

<span class="c1">-- 3. å®éªŒèƒ½åŠ› (ç”¨äº A/B Test)</span>
<span class="nf">interface</span><span class="w"> </span><span class="kt">Experiment</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">getVariant</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">ExperimentID</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="kt">Variant</span><span class="w"> </span><span class="c1">-- è¿”å› &#39;A&#39; æˆ– &#39;B&#39;</span>
<span class="w">  </span><span class="n">trackGoal</span><span class="w">  </span><span class="ow">::</span><span class="w"> </span><span class="kt">ExperimentID</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">MetricValue</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="nb">()</span>
</code></pre></div>

<h3 id="32-monadapp">3.2 ç»„åˆ Monadï¼š<code>App</code></h3>
<p>æˆ‘ä»¬çš„ Agent ç¨‹åºå°†è¿è¡Œåœ¨ä¸€ä¸ªåä¸º <code>App</code> çš„ Monad ä¸­ã€‚å®ƒæ˜¯æ‰€æœ‰è¿™äº›èƒ½åŠ›çš„<strong>äº¤é›†</strong>ã€‚</p>
<blockquote>
<p><strong>Rule of Thumb</strong>: å°½å¯èƒ½ä¿æŒ Effect ç²’åº¦ç»†å°ã€‚ä¸è¦å®šä¹‰ä¸€ä¸ªå·¨å¤§çš„ <code>AgentHelper</code> æ¥å£ï¼Œè€Œæ˜¯æ‹†åˆ†ä¸º <code>Reader</code>, <code>Writer</code>, <code>Shell</code> ç­‰ï¼Œè¿™æ ·æ–¹ä¾¿æµ‹è¯•æ—¶åª Mock å…¶ä¸­ä¸€éƒ¨åˆ†ã€‚</p>
</blockquote>
<hr />
<h2 id="4-kleisli">4. ç¬¬äºŒå±‚ï¼šKleisli ç®­å¤´ä¸é€»è¾‘ç¼–æ’</h2>
<p>è¿™æ˜¯ Agent çš„â€œå¤§è„‘â€ã€‚æˆ‘ä»¬ä½¿ç”¨ Kleisli Arrow å°†å„ä¸ªæ­¥éª¤ä¸²è”èµ·æ¥ã€‚
å›æƒ³ä¸€ä¸‹ï¼ŒKleisli Arrow çš„å½¢çŠ¶æ˜¯ <code>a -&gt; m b</code>ã€‚</p>
<h3 id="41-agent-the-state">4.1 å®šä¹‰ Agent çš„çŠ¶æ€ (The State)</h3>
<p>Agent åœ¨æ­¥éª¤ä¹‹é—´æµè½¬æ—¶ï¼Œéœ€è¦æºå¸¦çŠ¶æ€ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="kr">type</span><span class="w"> </span><span class="nx">AgentState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">issue</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">          </span><span class="c1">// åŸå§‹éœ€æ±‚</span>
<span class="w">  </span><span class="nx">plan</span><span class="o">:</span><span class="w"> </span><span class="kt">PlanStep</span><span class="p">[];</span><span class="w">       </span><span class="c1">// å½“å‰è®¡åˆ’</span>
<span class="w">  </span><span class="nx">history</span><span class="o">:</span><span class="w"> </span><span class="kt">ChatHistory</span><span class="p">;</span><span class="w">   </span><span class="c1">// å¯¹è¯å†å²</span>
<span class="w">  </span><span class="nx">filesChanged</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span><span class="w"> </span><span class="c1">// ä¿®æ”¹è¿‡çš„æ–‡ä»¶åˆ—è¡¨</span>
<span class="w">  </span><span class="nx">attemptCount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w">   </span><span class="c1">// å½“å‰å°è¯•æ¬¡æ•°</span>
<span class="p">};</span>
</code></pre></div>

<h3 id="42">4.2 æ ¸å¿ƒæµç¨‹ç®­å¤´</h3>
<p>æˆ‘ä»¬å°†å¤æ‚çš„ Coding ä»»åŠ¡æ‹†è§£ä¸ºå››ä¸ªåŸå­ç®­å¤´ï¼š</p>
<ol>
<li>
<p><strong><code>planner</code></strong>: <code>AgentState -&gt; App AgentState</code>
* è¯»å– <code>issue</code>ï¼Œåˆ†æä»£ç åº“ï¼Œç”Ÿæˆ <code>plan</code>ã€‚</p>
</li>
<li>
<p><strong><code>coder</code></strong>: <code>AgentState -&gt; App AgentState</code>
* è¯»å– <code>plan</code> ä¸­çš„å½“å‰æ­¥éª¤ï¼Œè°ƒç”¨ <code>LLM</code> ç”Ÿæˆä»£ç ï¼Œè°ƒç”¨ <code>WorkSpace</code> å†™å…¥æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><strong><code>verifier</code></strong>: <code>AgentState -&gt; App AgentState</code>
* è°ƒç”¨ <code>WorkSpace</code> è¿è¡Œ linter å’Œ testã€‚å¦‚æœå¤±è´¥ï¼Œæ›´æ–° <code>history</code> åŒ…å«é”™è¯¯ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><strong><code>updater</code></strong>: <code>AgentState -&gt; App AgentState</code>
* æ ¹æ® verify çš„ç»“æœï¼Œå†³å®šæ˜¯æ ‡è®°å½“å‰æ­¥éª¤å®Œæˆï¼Œè¿˜æ˜¯å¢åŠ  <code>attemptCount</code> é‡è¯•ã€‚</p>
</li>
</ol>
<h3 id="43-the-pipeline">4.3 ç»„åˆç®¡é“ (The Pipeline)</h3>
<p>åˆ©ç”¨ Kleisli ç»„åˆç¬¦ <code>&gt;=&gt;</code> (andThen)ï¼Œæˆ‘ä»¬å°†å®ƒä»¬ä¸²æˆä¸€ä¸ªå¾ªç¯ä½“ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- å•æ¬¡è¿­ä»£é€»è¾‘</span>
<span class="nf">step</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">AgentState</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">App</span><span class="w"> </span><span class="kt">AgentState</span>
<span class="nf">step</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">planner</span><span class="w"> </span><span class="o">&gt;=&gt;</span><span class="w"> </span><span class="n">coder</span><span class="w"> </span><span class="o">&gt;=&gt;</span><span class="w"> </span><span class="n">verifier</span><span class="w"> </span><span class="o">&gt;=&gt;</span><span class="w"> </span><span class="n">updater</span>

<span class="c1">-- é€’å½’æ‰§è¡Œç›´åˆ°å®Œæˆæˆ–è€—å°½é¢„ç®—</span>
<span class="nf">runLoop</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">AgentState</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">App</span><span class="w"> </span><span class="kt">AgentState</span>
<span class="nf">runLoop</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">newState</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">state</span>
<span class="w">  </span><span class="kr">if</span><span class="w"> </span><span class="n">isComplete</span><span class="p">(</span><span class="n">newState</span><span class="p">)</span><span class="w"> </span>
<span class="w">     </span><span class="kr">then</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="n">newState</span>
<span class="w">     </span><span class="kr">else</span><span class="w"> </span><span class="n">runLoop</span><span class="w"> </span><span class="n">newState</span><span class="w"> </span><span class="c1">-- é€’å½’è°ƒç”¨</span>
</code></pre></div>

<p>è¿™é‡Œå±•ç¤ºäº† IO Monad çš„å¨åŠ›ï¼šæˆ‘ä»¬åƒå†™æ™®é€šå‘½ä»¤å¼ä»£ç ä¸€æ ·ç»„åˆé€»è¾‘ï¼Œä½† <code>step</code>ã€<code>planner</code> ç­‰å‡½æ•°æœ¬èº«æ˜¯çº¯å‡½æ•°ï¼Œå®ƒä»¬åªè¿”å›â€œæè¿°è®¡ç®—çš„å€¼â€ã€‚</p>
<hr />
<h2 id="5-middleware">5. ç¬¬ä¸‰å±‚ï¼šä¸­é—´ä»¶ (Middleware) ä¸å®‰å…¨æ€§</h2>
<p>è¿™æ˜¯åŒºåˆ† Demo å’Œ Production çš„å…³é”®å±‚ã€‚æˆ‘ä»¬ä¸åœ¨ <code>runLoop</code> é‡Œå†™ <code>if (loop_detected) break</code>ï¼Œè€Œæ˜¯å°† <code>runLoop</code> åŒ…è£¹åœ¨ä¸­é—´ä»¶ä¸­ã€‚</p>
<h3 id="51-loop-detection">5.1 Loop Detection ä¸­é—´ä»¶</h3>
<p><strong>åŸç†</strong>ï¼š
Coding Agent å®¹æ˜“é™·å…¥â€œç›²ç›®é‡è¯•â€â€”â€”ä¿®æ”¹ä»£ç  -&gt; æµ‹è¯•å¤±è´¥ -&gt; å†æ¬¡ä¿®æ”¹(ç›¸åŒä»£ç ) -&gt; æµ‹è¯•å¤±è´¥ã€‚</p>
<p><strong>å®ç°</strong>ï¼š
æˆ‘ä»¬éœ€è¦ä¸€ä¸ª <code>Stateful Middleware</code>ã€‚å®ƒç»´æŠ¤ä¸€ä¸ªæ»‘åŠ¨çª—å£çš„ <strong>Action-Result Fingerprint</strong>ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ä¼ªä»£ç ï¼šä¸­é—´ä»¶é«˜é˜¶å‡½æ•°</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">withLoopDetection</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">  </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="kt">Kleisli</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">,</span><span class="w"> </span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nx">windowSize</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Kleisli</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">,</span><span class="w"> </span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">inputState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 1. è·å–å½“å‰ç¯å¢ƒçš„ Trace ID æˆ– Context</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">history</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getExecutionHistory</span><span class="p">();</span><span class="w"> </span>

<span class="w">    </span><span class="c1">// 2. æ‰§è¡ŒåŠ¨ä½œ</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">action</span><span class="p">(</span><span class="nx">inputState</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 3. è®¡ç®—æŒ‡çº¹</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">hash</span><span class="p">({</span>
<span class="w">      </span><span class="nx">action</span><span class="o">:</span><span class="w"> </span><span class="kt">inputState.currentAction</span><span class="p">,</span>
<span class="w">      </span><span class="nx">output</span><span class="o">:</span><span class="w"> </span><span class="kt">result.testOutput</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">error</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// 4. æ£€æµ‹é‡å¤</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">countOccurrences</span><span class="p">(</span><span class="nx">history</span><span class="p">,</span><span class="w"> </span><span class="nx">fingerprint</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="c1">// è§¦å‘ç†”æ–­</span>
<span class="w">       </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">LoopDetectedError</span><span class="p">(</span><span class="s2">&quot;Detected repetitive futile actions.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="52-ab-test">5.2 A/B Test æ³¨å…¥</h3>
<p>A/B Test å¯ä»¥åœ¨ä¸¤ä¸ªå±‚é¢è¿›è¡Œï¼š</p>
<ol>
<li><strong>Prompt å±‚é¢</strong>ï¼šåœ¨ <code>coder</code> ç®­å¤´å†…éƒ¨ï¼Œè°ƒç”¨ <code>Experiment.getVariant('prompt_strategy')</code>ï¼Œæ ¹æ®è¿”å›æ˜¯ 'A' (COT) è¿˜æ˜¯ 'B' (Direct) é€‰æ‹©ä¸åŒçš„ Prompt æ¨¡æ¿ã€‚</li>
<li><strong>æµç¨‹å±‚é¢</strong>ï¼šåœ¨ <code>step</code> ç»„åˆæ—¶åŠ¨æ€è·¯ç”±ã€‚</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1">-- åŠ¨æ€ç®¡é“æ„å»º</span>
<span class="nf">buildPipeline</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">App</span><span class="w"> </span><span class="p">(</span><span class="kt">AgentState</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">App</span><span class="w"> </span><span class="kt">AgentState</span><span class="p">)</span>
<span class="nf">buildPipeline</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">variant</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">getVariant</span><span class="w"> </span><span class="s">&quot;review_strategy&quot;</span>
<span class="w">  </span><span class="kr">case</span><span class="w"> </span><span class="n">variant</span><span class="w"> </span><span class="kr">of</span>
<span class="w">    </span><span class="s">&quot;strict&quot;</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">planner</span><span class="w"> </span><span class="o">&gt;=&gt;</span><span class="w"> </span><span class="n">coder</span><span class="w"> </span><span class="o">&gt;=&gt;</span><span class="w"> </span><span class="n">strictVerifier</span><span class="p">)</span>
<span class="w">    </span><span class="s">&quot;lax&quot;</span><span class="w">    </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="n">planner</span><span class="w"> </span><span class="o">&gt;=&gt;</span><span class="w"> </span><span class="n">coder</span><span class="w"> </span><span class="o">&gt;=&gt;</span><span class="w"> </span><span class="n">basicVerifier</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="6-interpreters">6. ç¬¬å››å±‚ï¼šè§£é‡Šå™¨ (Interpreters)</h2>
<p>è§£é‡Šå™¨æ˜¯ Effect çœŸæ­£è½åœ°çš„åœ°æ–¹ã€‚</p>
<h3 id="61-the-production-runtime">6.1 ç”Ÿäº§ç¯å¢ƒè§£é‡Šå™¨ (The Production Runtime)</h3>
<ul>
<li><strong>FileSystem</strong>: æ˜ å°„åˆ° Docker å®¹å™¨å†…çš„ <code>docker exec fs_container ...</code>ã€‚</li>
<li><strong>LLM</strong>: è°ƒç”¨ OpenAI/Anthropic APIï¼Œå¹¶å¤„ç† Rate Limitã€‚</li>
<li><strong>Observability</strong>: å°†æ—¥å¿—å‘é€åˆ° Datadog/Jaegerã€‚</li>
</ul>
<h3 id="62-the-replay-runtime">6.2 å½•åˆ¶ä¸å›æ”¾è§£é‡Šå™¨ (The Replay Runtime)</h3>
<p>ä¸ºäº†è°ƒè¯•æå…¶è´µçš„ Agent è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦â€œæ—¶å…‰æœºâ€ã€‚</p>
<ul>
<li><strong>Record Mode</strong>: åœ¨æ‰§è¡ŒçœŸå® IO æ—¶ï¼Œå°† <code>(Function, Args) -&gt; Result</code> åºåˆ—åŒ–å­˜å…¥ JSON æ–‡ä»¶ã€‚</li>
<li><strong>Replay Mode</strong>: æ‹¦æˆªæ‰€æœ‰ Effectã€‚å½“è¯·æ±‚ <code>chat(msg)</code> æ—¶ï¼Œä¸è”ç½‘ï¼Œè€Œæ˜¯æŸ¥é˜… JSON æ–‡ä»¶è¿”å›å†å²æ•°æ®ã€‚</li>
</ul>
<blockquote>
<p><strong>å…³é”®ç‚¹</strong>ï¼š<code>Clock</code> å’Œ <code>Random</code> ä¹Ÿå¿…é¡»è¢« Mock/Replayï¼Œå¦åˆ™æ— æ³•å®ç°ç¡®å®šæ€§å¤ç°ã€‚</p>
</blockquote>
<hr />
<h2 id="7-frp-bridging-to-ui">7. ç¬¬äº”å±‚ï¼šFRP æ¡¥æ¥ (Bridging to UI)</h2>
<p>Agent åœ¨æœåŠ¡ç«¯è·‘å¾—æ¬¢ï¼Œä½†ç”¨æˆ·çœ‹æµè§ˆå™¨ä¸èƒ½ä¸€ç›´ loadingã€‚æˆ‘ä»¬éœ€è¦å°† IO æ‰§è¡Œè¿‡ç¨‹â€œå¹¿æ’­â€å‡ºå»ã€‚</p>
<h3 id="71">7.1 äº‹ä»¶æ€»çº¿è®¾è®¡</h3>
<p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª <code>Event</code> ä»£æ•°ç±»å‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="kr">type</span><span class="w"> </span><span class="nx">AgentEvent</span><span class="w"> </span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Thinking&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">plan</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ToolCall&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">tool</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ToolOutput&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;TokenStream&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">chunk</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// æµå¼æ–‡å­—</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Error&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>

<h3 id="72-io-stream">7.2 IO åˆ° Stream çš„è½¬æ¢</h3>
<p>æˆ‘ä»¬åœ¨è§£é‡Šå™¨å±‚å¼•å…¥ä¸€ä¸ª <code>Subject</code> (æ¥è‡ª RxJS æˆ–ç±»ä¼¼åº“)ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">StreamingInterpreter</span><span class="w"> </span><span class="k">implements</span><span class="w"> </span><span class="nx">LLM</span><span class="p">,</span><span class="w"> </span><span class="nx">WorkSpace</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="k">private</span><span class="w"> </span><span class="nx">eventBus</span><span class="o">:</span><span class="w"> </span><span class="kt">Subject</span><span class="o">&lt;</span><span class="nx">AgentEvent</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">chat</span><span class="p">(</span><span class="nx">msgs</span><span class="o">:</span><span class="w"> </span><span class="kt">Message</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">next</span><span class="p">({</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Thinking&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">plan</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Contacting LLM...&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// ... è°ƒç”¨ LLM ...</span>
<span class="w">    </span><span class="c1">// ... æ”¶åˆ° chunk ...</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">next</span><span class="p">({</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;TokenStream&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">chunk</span><span class="o">:</span><span class="w"> </span><span class="kt">chunk</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">exec</span><span class="p">(</span><span class="nx">cmd</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">next</span><span class="p">({</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ToolCall&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">tool</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;shell&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="o">:</span><span class="w"> </span><span class="kt">cmd</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">realExec</span><span class="p">(</span><span class="nx">cmd</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">next</span><span class="p">({</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ToolOutput&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="o">:</span><span class="w"> </span><span class="kt">res.stdout</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>å‰ç«¯ UI åªéœ€è¦è®¢é˜…è¿™ä¸ª <code>eventBus</code>ï¼Œå³å¯å®æ—¶æ¸²æŸ“â€œæ­£åœ¨æ€è€ƒ...â€ã€â€œæ­£åœ¨ä¿®æ”¹æ–‡ä»¶ A...â€ç­‰çŠ¶æ€ã€‚</p>
<hr />
<h2 id="8">8. æœ¬ç« å°ç»“</h2>
<p>é€šè¿‡æœ¬ç« çš„ <code>PolyGlotCoder</code> æ¡ˆä¾‹ï¼Œæˆ‘ä»¬éªŒè¯äº†ï¼š</p>
<ol>
<li><strong>å¤æ‚æ€§ç®¡ç†</strong>ï¼šé€šè¿‡ IO Monad å’Œ DSLï¼Œæˆ‘ä»¬å°†å¤æ‚çš„ Coding Agent æ‹†è§£ä¸ºå¯ç®¡ç†ã€å¯æµ‹è¯•çš„å°å—ã€‚</li>
<li><strong>é²æ£’æ€§</strong>ï¼šLoop Detection å’Œ Timeout ä¸å†æ˜¯ä¸šåŠ¡é€»è¾‘çš„è´Ÿæ‹…ï¼Œè€Œæ˜¯è¿‡ Middleware ç»Ÿä¸€æ²»ç†ã€‚</li>
<li><strong>å¯è§‚æµ‹æ€§</strong>ï¼šé€šè¿‡è§£é‡Šå™¨æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å®ç° A/B æµ‹è¯•æ’æ¡©å’Œå…¨é‡å½•åˆ¶å›æ”¾ã€‚</li>
<li><strong>äº¤äº’æ€§</strong>ï¼šåˆ©ç”¨ FRPï¼Œæˆ‘ä»¬æ‰“é€šäº†åŒæ­¥çš„ Agent é€»è¾‘ä¸å¼‚æ­¥çš„ UI äº¤äº’ã€‚</li>
</ol>
<p><strong>Rule of Thumb</strong>:</p>
<blockquote>
<p>å¦‚æœä½ çš„ Agent ä»£ç ä¸­å……æ»¡äº† <code>try-catch</code>ã€<code>if (config.isTest)</code> æˆ–è€…æ‰‹å†™çš„é‡è¯•å¾ªç¯ï¼Œè¯´æ˜ä½ çš„æŠ½è±¡å±‚çº§ä¸å¤Ÿã€‚<strong>æŠŠæ§åˆ¶æµå˜æˆ Effectï¼ŒæŠŠç¯å¢ƒå˜æˆ Interpreterã€‚</strong></p>
</blockquote>
<hr />
<h2 id="9">9. ç»ƒä¹ é¢˜</h2>
<h3 id="_1">åŸºç¡€é¢˜</h3>
<details>
<summary><strong>ç»ƒä¹  11.1ï¼šå®ç°ç®€å•çš„æ²™ç®±æ–‡ä»¶ç³»ç»Ÿè§£é‡Šå™¨ (Mock Interpreter)</strong></summary>
<p><strong>é¢˜ç›®</strong>ï¼š
è¯·ç”¨å†…å­˜ä¸­çš„ <code>Map&lt;Path, Content&gt;</code> å®ç° <code>WorkSpace</code> æ¥å£ã€‚
è¦æ±‚ï¼š</p>
<ol>
<li><code>readFile</code> å¦‚æœè·¯å¾„ä¸å­˜åœ¨åº”æŠ›å‡ºæ˜ç¡®çš„ Domain Errorã€‚</li>
<li><code>exec</code> å¯¹äº <code>ls</code> å‘½ä»¤åº”è¿”å› Map ä¸­çš„ keysã€‚</li>
</ol>
<p><strong>Hint</strong>: è¿™å±•ç¤ºäº†å¦‚ä½•åœ¨ä¸ä¾èµ–çœŸå® OS çš„æƒ…å†µä¸‹æµ‹è¯• Agent é€»è¾‘ã€‚</p>
<details>
<summary><strong>å‚è€ƒç­”æ¡ˆ</strong></summary>
<div class="codehilite"><pre><span></span><code><span class="c1">// ç®€å•çš„å†…å­˜æ–‡ä»¶ç³»ç»Ÿè§£é‡Šå™¨</span>
<span class="kd">class</span><span class="w"> </span><span class="nx">InMemoryWorkSpace</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">files</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">path</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`FileNotFound: </span><span class="si">${</span><span class="nx">path</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="o">!</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="w"> </span><span class="nx">content</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">exec</span><span class="p">(</span><span class="nx">cmd</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="nx">stdout</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cmd</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">&quot;ls&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">stdout</span><span class="o">:</span><span class="w"> </span><span class="kt">Array.from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">keys</span><span class="p">()).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">stdout</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;mock exec result&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</details>
</details>
<details>
<summary><strong>ç»ƒä¹  11.2ï¼šKleisli é”™è¯¯å¤„ç† (Error Handling)</strong></summary>
<p><strong>é¢˜ç›®</strong>ï¼š
å‡è®¾ <code>coder</code> æ­¥éª¤å¯èƒ½ä¼šå› ä¸º Token è¶…é™è€Œå¤±è´¥ã€‚è¯·ä¿®æ”¹ Kleisli ç®¡é“ï¼Œä½¿å¾—ï¼š
å¦‚æœ <code>coder</code> å¤±è´¥ï¼Œè‡ªåŠ¨å›é€€åˆ°ä¸€ä¸ªæ›´ç®€å•çš„ <code>summarizer</code> æ­¥éª¤ï¼ˆå‹ç¼©ä¸Šä¸‹æ–‡ï¼‰ï¼Œç„¶åå†é‡è¯• <code>coder</code>ã€‚</p>
<p><strong>Hint</strong>: ä½¿ç”¨ <code>catchError</code> æˆ– <code>orElse</code> ç»„åˆå­ã€‚ç»“æ„ç±»ä¼¼äº <code>coder.orElse(summarizer &gt;=&gt; coder)</code>ã€‚</p>
<details>
<summary><strong>å‚è€ƒç­”æ¡ˆ</strong></summary>
<div class="codehilite"><pre><span></span><code><span class="c1">-- ä¼ªä»£ç é€»è¾‘</span>
<span class="nf">safeCoder</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">AgentState</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">App</span><span class="w"> </span><span class="kt">AgentState</span>
<span class="nf">safeCoder</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">catchError</span><span class="w"> </span><span class="n">coder</span><span class="w"> </span><span class="n">handler</span>
<span class="w">  </span><span class="kr">where</span>
<span class="w">    </span><span class="n">handler</span><span class="w"> </span><span class="ne">error</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="n">log</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Coder failed, summarizing context: &quot;</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="ne">error</span><span class="p">)</span>
<span class="w">      </span><span class="c1">-- ç»„åˆï¼šå…ˆå‹ç¼©ï¼Œå†é‡è¯•ç¼–ç </span>
<span class="w">      </span><span class="n">summarizer</span><span class="w"> </span><span class="o">&gt;=&gt;</span><span class="w"> </span><span class="n">coder</span><span class="w"> </span>
</code></pre></div>

</details>
</details>
<h3 id="_2">æŒ‘æˆ˜é¢˜</h3>
<details>
<summary><strong>ç»ƒä¹  11.3ï¼šå®ç° Time-Travel Debugger çš„æ ¸å¿ƒæ•°æ®ç»“æ„</strong></summary>
<p><strong>é¢˜ç›®</strong>ï¼š
è®¾è®¡ä¸€ä¸ª JSON Schemaï¼Œç”¨äºå­˜å‚¨ Agent çš„ä¸€æ¬¡å®Œæ•´è¿è¡Œè®°å½•ï¼ˆTapeï¼‰ã€‚
è¦æ±‚ï¼š</p>
<ol>
<li>å¿…é¡»èƒ½æ”¯æŒå¹¶å‘è¯·æ±‚çš„å½•åˆ¶ï¼ˆå¦‚æœ Agent å¹¶è¡Œè°ƒç”¨äº† 3 ä¸ªå·¥å…·ï¼‰ã€‚</li>
<li>å¿…é¡»åŒ…å«éšæœºç§å­çš„çŠ¶æ€ã€‚</li>
<li>æ€è€ƒå¦‚ä½•å¤„ç†éç¡®å®šæ€§çš„æ—¶é—´æˆ³ï¼ˆClock Effectï¼‰ã€‚</li>
</ol>
<p><strong>Hint</strong>: è®°å½•ä¸æ˜¯ç®€å•çš„ Listï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªä»¥ <code>(StepID, EffectType, InputHash)</code> ä¸ºé”®çš„ Mapã€‚</p>
<details>
<summary><strong>å‚è€ƒç­”æ¡ˆ</strong></summary>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;agentVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-10-27T10:00:00Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;randomSeed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;interactions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;stepId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LLM.chat&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;inputHash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sha256-of-messages&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sure, I can help...&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;durationMs&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1500</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;stepId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WorkSpace.exec&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;cmd&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ls -la&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;exitCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;stdout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;main.py\nREADME.md&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;mockedTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-10-27T10:00:05Z&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>å…³é”®è®¾è®¡</strong>ï¼šåœ¨ Replay æ—¶ï¼Œè§£é‡Šå™¨ä¸ä»…è¦åŒ¹é…å‡½æ•°åï¼Œæœ€å¥½è¿˜è¦åŒ¹é… <code>inputHash</code>ï¼Œä»¥é˜²æ­¢ä»£ç é€»è¾‘å˜æ›´å¯¼è‡´è¯·æ±‚å‚æ•°å˜åŒ–ï¼Œä»è€Œé”™è¯¯åœ°åŒ¹é…äº†å†å²è®°å½•ã€‚</p>
</details>
</details>
<details>
<summary><strong>ç»ƒä¹  11.4ï¼šLoop Detection çš„â€œè¯­ä¹‰â€åˆ¤é‡</strong></summary>
<p><strong>é¢˜ç›®</strong>ï¼š
Coding Agent æœ‰æ—¶ä¼šä¿®æ”¹ä»£ç ï¼Œä½†æ”¹åŠ¨ä»…ä»…æ˜¯åŠ äº†ä¸€ä¸ªç©ºæ ¼æˆ–æ¢è¡Œã€‚å¯¹äºç¼–è¯‘å™¨æ¥è¯´è¿™æ˜¯ä¸åŒçš„æ–‡ä»¶ï¼Œä½†å¯¹äºå†³ Bug æ¥è¯´è¿™æ˜¯æ­»å¾ªç¯ã€‚
è¯·è®¾è®¡ä¸€ä¸ª <code>SemanticLoopDetector</code>ï¼Œå®ƒä¸æ¯”è¾ƒæ–‡ä»¶ Hashï¼Œè€Œæ˜¯æ¯”è¾ƒ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰æˆ– Token åºåˆ—çš„ç›¸ä¼¼åº¦ã€‚</p>
<p><strong>Hint</strong>: ä½ éœ€è¦åœ¨ <code>WorkSpace</code> Effect ä¸­å¢åŠ ä¸€ä¸ª <code>diff(fileA, fileB)</code> çš„èƒ½åŠ›ï¼Œæˆ–è€…åœ¨ä¸­é—´ä»¶ä¸­è§£æä»£ç ã€‚</p>
<details>
<summary><strong>å‚è€ƒç­”æ¡ˆ</strong></summary>
<p><strong>å®ç°æ€è·¯</strong>ï¼š</p>
<ol>
<li><strong>æ ‡å‡†åŒ–ï¼ˆNormalizationï¼‰</strong>ï¼š
åœ¨è®¡ç®— Hash ä¹‹å‰ï¼Œå¯¹ä»£ç å†…å®¹è¿›è¡Œé¢„å¤„ç†ï¼š</li>
</ol>
<ul>
<li>å»é™¤æ‰€æœ‰æ³¨é‡Šã€‚</li>
<li>å»é™¤æ‰€æœ‰ç©ºè¡Œå’Œå¤šä½™ç©ºæ ¼ã€‚</li>
<li>(è¿›é˜¶) é‡å‘½åå±€éƒ¨å˜é‡ä¸º v1, v2... (Alpha-renaming)ã€‚</li>
</ul>
<ol start="2">
<li><strong>ä¸­é—´ä»¶é€»è¾‘</strong>ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">normalizeCode</span><span class="p">(</span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ç®€å•æ­£åˆ™å»ç©ºè¡Œå»ç©ºæ ¼</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// åœ¨ Loop Detector ä¸­</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">currentCodeHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sha256</span><span class="p">(</span><span class="nx">normalizeCode</span><span class="p">(</span><span class="nx">fileContent</span><span class="p">));</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">historyHashes</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">currentCodeHash</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Semantic Loop Detected: Code effectively unchanged.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

</details>
</details>
<hr />
<h2 id="10-gotchas">10. å¸¸è§é™·é˜±ä¸é”™è¯¯ (Gotchas)</h2>
<h3 id="1-leaky-abstractions">1. æ³„éœ²çš„æŠ½è±¡ (Leaky Abstractions)</h3>
<ul>
<li><strong>ç°è±¡</strong>ï¼šä½ çš„ DSL å®šä¹‰äº† <code>exec(cmd)</code>ï¼Œä½†åœ¨ä¸šåŠ¡é€»è¾‘é‡Œä½ å†™äº† <code>exec('ls -la | grep "foo"')</code>ã€‚</li>
<li><strong>é—®é¢˜</strong>ï¼šè¿™åœ¨ Linux ä¸Šèƒ½è·‘ï¼Œåœ¨ Windows å¼€å‘è€…çš„æœ¬åœ°ç¯å¢ƒæˆ–è€…æŸäº›ç²¾ç®€ç‰ˆ Docker å®¹å™¨é‡Œä¼šæŠ¥é”™ã€‚</li>
<li><strong>å¯¹ç­–</strong>ï¼š<strong>DSL åº”è¯¥æ›´å…·è¯­ä¹‰åŒ–</strong>ã€‚å®šä¹‰ <code>listFiles(pattern)</code> è€Œä¸æ˜¯ä¾èµ– Shell å‘½ä»¤ã€‚å¦‚æœå¿…é¡»ç”¨ Shellï¼Œè¯·åœ¨è§£é‡Šå™¨å±‚åš OS åˆ¤æ–­å’Œé€‚é…ã€‚</li>
</ul>
<h3 id="2-ab-test">2. A/B Test çš„â€œå¹½çµå˜é‡â€</h3>
<ul>
<li><strong>ç°è±¡</strong>ï¼šä½ åœ¨è§£é‡Šå™¨é‡Œæ ¹æ® A/B æ ‡è®°ä¿®æ”¹äº† LLM çš„ Temperatureã€‚ä½†æ˜¯è¿™ä¸ª Temperature çš„å€¼æ²¡æœ‰è¢«è®°å½•åœ¨ Trace æ—¥å¿—é‡Œã€‚</li>
<li><strong>åæœ</strong>ï¼šå½“ä½ å‘ç°æŸç»„å®éªŒæ•ˆæœæå·®æ—¶ï¼Œä½ æ— æ³•å¤ç°ï¼Œå› ä¸ºä½ åªè®°å½•äº† Promptï¼Œæ²¡è®°å½•è§£é‡Šå™¨å·å·æ³¨å…¥çš„å‚æ•°ã€‚</li>
<li><strong>å¯¹ç­–</strong>ï¼š<strong>Explicit Context</strong>ã€‚æ‰€æœ‰çš„é…ç½®å˜æ›´ï¼ˆå³ä½¿æ˜¯è§£é‡Šå™¨æ³¨å…¥çš„ï¼‰éƒ½åº”è¯¥æ˜¾å¼åœ°å†™å…¥ <code>Metadata</code> æˆ– <code>Span Attributes</code> ä¸­ã€‚</li>
</ul>
<h3 id="3-frp">3. è¢«åæ‰çš„ FRP é”™è¯¯</h3>
<ul>
<li><strong>ç°è±¡</strong>ï¼šAgent è¿è¡Œå‡ºé”™ï¼ŒUI ä¸Šå´ä¸€ç›´è½¬åœˆåœˆã€‚</li>
<li><strong>åŸå› </strong>ï¼šFRP Stream çš„ <code>catchError</code> å¤„ç†ä¸å½“ï¼Œå¯¼è‡´æµæ„å¤–ç»ˆæ­¢ï¼ˆCompletedï¼‰ï¼Œè€Œä¸æ˜¯å‘é€ Error äº‹ä»¶ç»™ UIã€‚</li>
<li><strong>å¯¹ç­–</strong>ï¼šåœ¨ <code>flatMap</code> å†…éƒ¨æ•è·é”™è¯¯ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º <code>type: 'Error'</code> çš„å€¼äº‹ä»¶å‘é€å‡ºå»ï¼Œè€Œä¸æ˜¯è®©æ•´ä¸ª Stream å´©æºƒã€‚</li>
</ul>
            </article>
            
            <nav class="page-nav"><a href="chapter10.html" class="nav-link prev">â† Chapter 10 â€” ä¸ FRP çš„å…³ç³»ï¼šå½“ Agent å˜æˆâ€œäº‹ä»¶æµå¤„ç†å™¨â€ (chapter10.md)</a><a href="chapter12.html" class="nav-link next">Chapter 12 â€” æ‰©å±•é˜…è¯»ä¸è·¯çº¿å›¾ï¼šé€šå¾€ç±»å‹å®‰å…¨ä¸ç”Ÿäº§ç¯å¢ƒçš„å½¼å²¸ â†’</a></nav>
        </main>
    </div>
</body>
</html>